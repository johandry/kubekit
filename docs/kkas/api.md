# KubeKit API

The following links redirect you different forms of the KubeKit API documentation:

- [API and SDK Documentation](https://github.com/pages/liferaft/kubekit/kkas/api.html)
- Swagger [JSON](../../api/kubekit/v1/swagger/service.swagger.json) / [YAML](./swagger.yaml)
- [gRPC Proto](../../api/kubekit/v1/proto/) 
- [Swagger from KubeKit Server](#swagger-from-kubekit-server)
- [gRPC Proto](#grpc-proto)
- [Filter parameter](#filter-parameter)

## Swagger from the KubeKit Server

The KubeKit API is documented with swagger which is automatically generated by gRPC-Gateway every time  the API is modified. You can view it from the link above or view it directly from the KubeKit Server.

In addition to the REST/HTTP API, it also exposes the Swagger definitions. Note that the server exposes the gRPC and REST/HTTP API on the same port by default. Execute the following command in the terminal #1 to start the server:

```bash
kubekit start server
```

Then execute the following command in the terminal #2:

```bash
curl -k https://localhost:5823/swagger/kubekit.json
```

Or in your browser, go to  https://localhost:5823/swagger/kubekit.json.

To view the Swagger definition in the Swagger UI you can either: open the JSON file in the online [Swagger Editor](http://editor.swagger.io/#/), install Swagger UI [from here](https://github.com/swagger-api/swagger-ui), or use Swagger UI from a Docker container.

To use Swagger UI from a Docker container, make sure you have Docker installed and execute the following command:

```bash
API_URL=https://localhost:5823/swagger/kubekit.json

docker run -p 80:8080 -e API_URL=$API_URL swaggerapi/swagger-ui
```

Make sure the `API_URL` variable points to the URL where KubeKit Server is exposing the Swagger definition.

Then go to [localhost](http://localhost/) and you should see an error. This is because you are using HTTPS to expose the Swagger definition. So in the same browser open https://localhost:5823/swagger/kubekit.json and follow the instructions to accept the certificates and view the JSON content. Once you are able to see it, go to [localhost](http://localhost).

Viewing the Swagger definition in the [Swagger Editor](http://editor.swagger.io/#/) can help you to do other interesting things such as view the file in different formats and generate scaffolding code in different languages to access the API.

## gRPC Proto

The gRPC Proto is the source for the KubeKit API. From it, `protoc` generates the Go code used by the KubeKit Client and Server. With `protoc` and gRPC-Gateway it generates the REST/HTTP API, the Go code using REST API, and the Swagger JSON definition of the API.

There are multiple Proto files in the directory [api/kubekit/v1/proto](../../api/kubekit/v1/proto) to make it easier for maintenance. The entry point is the `service.proto` file and it contains all of the services that KubeKit is exposing. The other files contain the structures or messages used for the requests and responses.

## Filter parameter 

The API call to list the clusters GET `/api/v1/cluster` can receive a filter parameter. This parameter is a dictionary or map where the keys are the fields to filter by. The client can send multiple filter parameters to filter by different fields. 

This feature is implemented in various ways depending on the language. For example, the most common is something like this: `?filter[platform]=eks&filter[nodes]=5` to filter by clusters on EKS platform and with 5 nodes.

This kind of query is not fully yet implemented in gRPC-Gateway but it is possible to implement with a syntax like `?filter=platform%3Deks&filter=nodes%3D5`. The equal sign that normally separates the key and value pair must be encoded with `%3D` as in the example. Putting an equal sign between any of the key value pairs will throw an error.

The full example using `curl` looks like this:

```bash
curl -s -k "https://localhost:5823/api/v1/cluster?filter=platform%3Deks&filter=nodes%3D5" | jq
```





